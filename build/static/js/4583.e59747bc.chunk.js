"use strict";(self.webpackChunkwinston=self.webpackChunkwinston||[]).push([[4583],{24583:(e,n,t)=>{t.r(n),t.d(n,{TabPanels:()=>A,default:()=>C});var a=t(65043),s=t(35721),r=t(30681),l=t(12110),i=t(53404),o=t(26494),c=t(85865),d=t(27600),u=t(46946),h=t(16704),x=t(24056),m=t(68903),p=t(29840),g=t(80077),f=t(76371),v=t(3915),j=t(70579);function y(e){let{messages:n,handleDeleteMessage:t,handleSaveMessage:u}=e;const h=a.useRef(null);return a.useEffect((()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)}),[n]),(0,j.jsx)(s.A,{ref:h,style:{maxHeight:"400px",overflow:"auto"},children:n.map(((e,n)=>(0,j.jsx)(r.Ay,{children:(0,j.jsxs)(l.A,{variant:"outlined",style:{width:"100%"},children:[!e.saved&&(0,j.jsx)(i.A,{variant:"contained",color:"primary",onClick:()=>u(e),style:{float:"right",marginRight:"8px"},children:"Save"}),(0,j.jsx)(i.A,{variant:"contained",color:"secondary",onClick:()=>t(n,!0),style:{float:"right"},children:"Delete"}),(0,j.jsxs)(o.A,{children:[(0,j.jsxs)(c.A,{variant:"body2",color:"textSecondary",component:"p",children:[(0,j.jsx)("strong",{children:"To:"})," ",e.to]}),(0,j.jsxs)(c.A,{variant:"body2",color:"textSecondary",component:"p",children:[(0,j.jsx)("strong",{children:"Message:"})," ",e.message]}),(0,j.jsxs)(c.A,{variant:"body2",color:"textSecondary",component:"p",children:[(0,j.jsx)("strong",{children:"Date:"})," ",e.date]})]}),(0,j.jsx)(d.A,{children:(0,j.jsx)(c.A,{variant:"body2",color:"textSecondary",component:"p",children:e.saved?(0,j.jsx)("em",{children:"Saved"}):(0,j.jsx)("em",{children:"This message will self destruct in 30s"})})})]})},n)))})}function b(e){const{children:n,value:t,index:a,...s}=e;return(0,j.jsx)("div",{role:"tabpanel",hidden:t!==a,id:`tabpanel-${a}`,"aria-labelledby":`tab-${a}`,...s,children:t===a&&(0,j.jsx)(u.A,{p:3,children:n})})}function S(e){return{id:`tab-${e}`,"aria-controls":`tabpanel-${e}`}}function A(e){let{tabs:n,value:t,handleChange:s}=e;return(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A,{value:t,onChange:s,"aria-label":"tabs",children:n.map(((e,n)=>(0,a.createElement)(x.A,{label:e.label,...S(n),key:n})))}),n.map(((e,n)=>(0,j.jsx)(b,{value:t,index:n,children:e.component},n)))]})}function C(){const{connection:e}=(0,f.Ay)(),[n,t]=a.useState([]),[s,r]=a.useState(""),[l,o]=a.useState(""),c=(0,g.d4)(v.OC),[d,u]=a.useState("messages"),S=a.useRef(null),A=["messages","private","voting","saved"],C=a.useCallback((function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t((t=>{const a=[...t];return n||a[e]&&!a[e].saved?(a.splice(e,1),a):a}))}),[]),E=a.useCallback((()=>{const e=n.findIndex((e=>!e.saved));C(e)}),[C,n]);function w(e){t((n=>n.map((n=>n===e?{...n,saved:!0}:n))))}return a.useEffect((()=>{e.onmessage=async e=>{try{((e,n)=>{if(!n.SIG||""===n.SIG)return;if(!n.OP_CODE)return;let a=n.data;const s=()=>{t((e=>e.slice(1))),S.current=setTimeout(s,3e4)};"MESSAGE"===n.OP_CODE&&(c&&(a=n.data),t((e=>{const n=[...e,a];return S.current||(S.current=setTimeout(s,3e4)),n})))})(0,JSON.parse(await e.data.text(),!1,2))}catch(n){console.error(n)}}})),a.useEffect((()=>(n.length>0&&(S.current=setTimeout(E,3e4)),()=>{clearTimeout(S.current)})),[n,E]),(0,j.jsx)("div",{children:(0,j.jsxs)(m.Ay,{container:!0,spacing:1,children:[(0,j.jsxs)(m.Ay,{item:!0,xs:12,children:[(0,j.jsx)("h2",{children:"Message Log"}),(0,j.jsx)(h.A,{value:d,onChange:(e,n)=>{u(n)},textColor:"inherit",indicatorColor:"primary",children:A.map((e=>{return(0,j.jsx)(x.A,{label:e,value:e,...(n=0,{id:`tab-${n}`,"aria-controls":`tabpanel-${n}`})},e);var n}))}),A.map((e=>(0,j.jsx)(b,{value:d,index:e,children:(0,j.jsx)(y,{messages:n.filter((n=>n.channel===e)),handleDeleteMessage:C,handleSaveMessage:w})},e)))]}),(0,j.jsxs)(m.Ay,{item:!0,xs:12,children:[(0,j.jsx)("h2",{children:"Send Message"}),(0,j.jsxs)("form",{onSubmit:function(n){if(n.preventDefault(),!d||!l)return;const a={to:s,from:e.id,channel:d,message:l,date:(new Date).toISOString().split("T")[0],saved:!1};e.send(JSON.stringify({OP_CODE:"MESSAGE",SIG:"No_Sig",from:"anonymous",to:s,data:a})),t((e=>{const n=[...e,a];return S.current||(S.current=setTimeout(E,3e4)),n})),r(""),o("")},style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,j.jsx)(p.A,{id:"recipient",name:"recipient",label:"Recipient",variant:"outlined",fullWidth:!0,value:s,onChange:e=>r(e.target.value),autoComplete:"off"}),(0,j.jsx)(p.A,{id:"message",name:"message",label:"Message",variant:"outlined",multiline:!0,rows:4,fullWidth:!0,required:!0,value:l,onChange:e=>o(e.target.value),autoComplete:"off"}),(0,j.jsx)(i.A,{type:"submit",variant:"contained",color:"primary",children:"Send"})]})]})]})})}}}]);
//# sourceMappingURL=4583.e59747bc.chunk.js.map